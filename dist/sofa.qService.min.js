/**
 * sofa-q-service - v0.2.0 - 2014-07-22
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO).
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(a,b){"use strict";a.define("sofa.QService",function(){function c(c,d){function e(a){return a}function f(a){return j(a)}function g(b){var c=h(),d=0,e=a.Util.isArray(b)?[]:{};return a.Util.forEach(b,function(a,b){d++,i(a).then(function(a){e.hasOwnProperty(b)||(e[b]=a,--d||c.resolve(e))},function(a){e.hasOwnProperty(b)||c.reject(a)})}),0===d&&c.resolve(e),c.promise}var h=function(){var a,g,k=[];return g={resolve:function(d){if(k){var e=k;k=b,a=i(d),e.length&&c(function(){for(var b,c=0,d=e.length;d>c;c++)b=e[c],a.then(b[0],b[1],b[2])})}},reject:function(a){g.resolve(j(a))},notify:function(a){if(k){var b=k;k.length&&c(function(){for(var c,d=0,e=b.length;e>d;d++)c=b[d],c[2](a)})}},promise:{then:function(b,c,g){var i=h(),j=function(a){try{i.resolve((b||e)(a))}catch(c){d(c),i.reject(c)}},l=function(a){try{i.resolve((c||f)(a))}catch(b){d(b),i.reject(b)}},m=function(a){try{i.notify((g||e)(a))}catch(b){d(b)}};return k?k.push([j,l,m]):a.then(j,l,m),i.promise},always:function(a){function b(a,b){var c=h();return b?c.resolve(a):c.reject(a),c.promise}function c(c,d){var f=null;try{f=(a||e)()}catch(g){return b(g,!1)}return f&&f.then?f.then(function(){return b(c,d)},function(a){return b(a,!1)}):b(c,d)}return this.then(function(a){return c(a,!0)},function(a){return c(a,!1)})}}}},i=function(a){return a&&a.then?a:{then:function(b){var d=h();return c(function(){d.resolve(b(a))}),d.promise}}},j=function(a){return{then:function(b,d){var e=h();return c(function(){e.resolve((d||f)(a))}),e.promise}}},k=function(a,b,g,k){var l,m=h(),n=function(a){try{return(b||e)(a)}catch(c){return d(c),j(c)}},o=function(a){try{return(g||f)(a)}catch(b){return d(b),j(b)}},p=function(a){try{return(k||e)(a)}catch(b){d(b)}};return c(function(){i(a).then(function(a){l||(l=!0,m.resolve(i(a).then(n,o,p)))},function(a){l||(l=!0,m.resolve(o(a)))},function(a){l||m.notify(p(a))})}),m.promise};return{defer:h,reject:j,when:k,all:g}}return c(function(a){a()},function(a){console.log(a)})})}(sofa);